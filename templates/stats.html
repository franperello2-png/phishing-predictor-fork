<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PhishingPredictor | Estadísticas</title>

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:'Roboto',sans-serif;
  background:#f9f9f9;
  color:#333;
  min-height:100vh;
}

canvas#bgCanvas{
  position:fixed;
  inset:0;
  z-index:0;
}

/* ===== HEADER (MINIGAME) ===== */
header{
  position:relative;
  z-index:2;
  padding:1.5rem 3rem;
  background:rgba(255,255,255,0.95);
  box-shadow:0 4px 14px rgba(0,0,0,0.08);
  display:flex;
  justify-content:space-between;
  align-items:center;
}
header h1{
  font-size:2.2rem;
  font-weight:700;
  color:#1e3c72;
}
.home-btn{
  text-decoration:none;
  background:linear-gradient(135deg,#1e90ff,#00bfff);
  color:#fff;
  padding:0.6rem 1.6rem;
  border-radius:50px;
  font-weight:500;
  font-size:0.95rem;
  display:flex;
  align-items:center;
  gap:0.6rem;
}

/* ===== HERO ===== */
.hero{
  text-align:center;
  padding:3rem 2rem 1.5rem;
  position:relative;
  z-index:2;
}
.hero h2{
  font-size:2.4rem;
  color:#1e3c72;
}
.hero p{
  font-size:1.1rem;
  color:#555;
}

/* ===== GRID ===== */
.cards-container{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:2rem;
  padding:2rem 3rem;
  max-width:1200px;
  margin:auto;
  position:relative;
  z-index:2;
}
.card{
  background:#fff;
  padding:2rem;
  border-radius:20px;
  box-shadow:0 6px 15px rgba(0,0,0,0.1);
}
.card-title{
  display:flex;
  align-items:center;
  gap:0.75rem;
  margin-bottom:0.75rem;
}
.card-title i{font-size:1.6rem;color:#1e90ff}
.card h3{color:#1e3c72;font-size:1.15rem}
.kpis{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:12px}
.kpi{background:#eef3ff;border-radius:10px;padding:10px 12px}
.chartbox{border-radius:14px;border:1px solid rgba(0,0,0,0.06);padding:10px}

@media(max-width:900px){
  .cards-container{grid-template-columns:1fr;padding:1.5rem}
}
</style>
</head>

<body>

<canvas id="bgCanvas"></canvas>

<header>
  <h1>PhishingPredictor</h1>
  <a href="/" class="home-btn">
    <i class="fas fa-home"></i> Volver al inicio
  </a>
</header>

<section class="hero">
  <h2>Panel Estadístico</h2>
  <p>Visualización interactiva de datos reales del sistema.</p>
</section>

<section class="cards-container">

  <div class="card">
    <div class="card-title">
      <i class="fas fa-database"></i><h3>Dataset del minijuego</h3>
    </div>
    <div class="kpis" id="kpis-dataset"></div>
    <div class="chartbox"><canvas id="chartDataset"></canvas></div>
  </div>

  <div class="card">
    <div class="card-title">
      <i class="fas fa-gamepad"></i><h3>Rendimiento del minijuego</h3>
    </div>
    <div class="kpis" id="kpis-minigame"></div>
    <div class="chartbox"><canvas id="chartAccuracy"></canvas></div>
  </div>

  <div class="card">
    <div class="card-title">
      <i class="fas fa-robot"></i><h3>Cohere: mensajes</h3>
    </div>
    <div class="kpis" id="kpis-cohere"></div>
    <div class="chartbox"><canvas id="chartCohereMsg"></canvas></div>
  </div>

  <div class="card">
    <div class="card-title">
      <i class="fas fa-chart-bar"></i><h3>Probabilidad de phishing</h3>
    </div>
    <div class="chartbox"><canvas id="chartProb"></canvas></div>
  </div>

</section>

<script>
// ================= PARTICULAS NAVY =================
const canvas = document.getElementById("bgCanvas");
const ctx = canvas.getContext("2d");
canvas.width = innerWidth;
canvas.height = innerHeight;

const particles = [];
for(let i=0;i<90;i++){
  particles.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    r:Math.random()*5+2,
    vx:(Math.random()-.5)*0.8,
    vy:(Math.random()-.5)*0.8
  });
}

function animateBG(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  particles.forEach(p=>{
    p.x+=p.vx; p.y+=p.vy;
    if(p.x<0||p.x>canvas.width) p.vx*=-1;
    if(p.y<0||p.y>canvas.height) p.vy*=-1;
    ctx.beginPath();
    ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
    ctx.fillStyle="rgba(30,144,255,0.3)"; 
    ctx.fill();
  });
  requestAnimationFrame(animateBG);
}
animateBG();

addEventListener("resize",()=>{
  canvas.width=innerWidth;
  canvas.height=innerHeight;
});
</script>

<script>
fetch("/stats/data").then(r=>r.json()).then(d=>{

  document.getElementById("kpis-dataset").innerHTML =
    `<div class="kpi">Total: <strong>${d.dataset.n_images}</strong></div>
     <div class="kpi">Phishing: <strong>${d.dataset.n_phish}</strong></div>
     <div class="kpi">Legítimo: <strong>${d.dataset.n_legit}</strong></div>`;

  new Chart(chartDataset,{
    type:"bar",
    data:{labels:["Phishing","Legítimo"],
    datasets:[{data:[d.dataset.n_phish,d.dataset.n_legit]}]},
    options:{plugins:{legend:{display:false}}}
  });

  if(d.minigame_summary){
    document.getElementById("kpis-minigame").innerHTML =
      `<div class="kpi">Intentos: ${d.minigame_summary.total_attempts}</div>
       <div class="kpi">Acierto: ${d.minigame_summary.accuracy_pct}%</div>`;

    new Chart(chartAccuracy,{
      type:"line",
      data:{
        labels:d.daily_accuracy.labels,
        datasets:[{
          data:d.daily_accuracy.values,
          tension:.3,
          pointRadius:4,
          fill:false
        }]
      },
      options:{
        plugins:{legend:{display:false}},
        scales:{y:{min:0,max:100}}
      }
    });
  }

  if(d.cohere_summary){
    document.getElementById("kpis-cohere").innerHTML =
      `<div class="kpi">Mensajes: ${d.cohere_summary.mensajes}</div>
       <div class="kpi">No mensajes: ${d.cohere_summary.no_mensajes}</div>`;

    new Chart(chartCohereMsg,{
      type:"bar",
      data:{
        labels:d.cohere_msg_counts.labels,
        datasets:[{data:d.cohere_msg_counts.values}]
      },
      options:{plugins:{legend:{display:false}}}
    });

    new Chart(chartProb,{
      type:"bar",
      data:{
        labels:d.cohere_prob_hist.labels,
        datasets:[{data:d.cohere_prob_hist.counts}]
      },
      options:{
        plugins:{legend:{display:false}},
        scales:{
          x:{title:{display:true,text:"Rango de probabilidad (%)"}},
          y:{title:{display:true,text:"Número de mensajes"}}
        }
      }
    });
  }
});
</script>

</body>
</html>






